---
# "usbmount",
- name: "install apt-get packages"
  apt: 
    name: [  "exfat-fuse", "exfat-utils", "ntfs-3g" ]
    state: present
    update_cache: yes
    cache_valid_time: 3600

#- name: "set mount flag 1"
#  replace:
#    path: /lib/systemd/system/systemd-udevd.service
#    regexp: 'MountFlags=slave'
#    replace: 'MountFlags=shared'

#- name: "set mount flag 2"
#  lineinfile:
#    path: /lib/systemd/system/systemd-udevd.service
#    line: 'MountFlags=shared'

- name: Creates directory
  file:
    path: /media/{{ item }}
    state: directory
  with_items: "{{ labels }}"

- name: Mount up device by label
  mount:
    path: /media/{{ item }}
    src: "LABEL={{ item }}"
    boot: False
    opt: "user,nofail"
    fstype: exfat
    state: present
  with_items: "{{ labels }}"
  ignore_errors: True
